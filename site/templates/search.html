{% extends "base.html" %}
{% import "macros.html" as macros %}
{% block title %}Search with Tidder!{% endblock %}

{% block content %}
    <style>
     .search-header {
         display: flex;
         flex-direction: column;
         align-items: center;
     }
     input {
         background-color: #fefefe;
         color: #454545;
         border-radius: 2px;
         border: none;
         padding: .15em .25em;
     }
     .search-input-label {
     }
     .search-input {
         min-width: 30vw;
     }
     .search-distance {
         min-width: 5vw;
         max-width: 4em;
     }
     #search-form {
         align-self: stretch;
         display: flex;
         width: 100%;
         flex-direction: column;
     }
     #search-form label, .search-nsfw-box {
         display: flex;
         align-items: center;
         gap: .3em;
     }
     .search-row {
         display: flex;
         justify-content: center;
         margin: .2em 0;
         gap: .3em;
     }
     .search-send {
         min-width: 30vw;
     }
    </style>
    <div class="search-header">
        <h1>Search for an image!</h1>
        <form method="get" id="search-form" search-action="/search">
            <div class="search-row">
                <label id="search-link" class="search-input-label"><span>Link:</span><input class="search-upload-type" type="radio" name="uploadtype" value="link" {{ form.upload|tern(yes="", no="checked ") }}/><input class="search-input" name="imagelink" type="url" value="{{ form.link }}"/></label>
                <label id="search-file" class="search-input-label"><span>File:</span><input class="search-upload-type" type="radio" name="uploadtype" value="file" {{ form.upload|tern(yes="checked ", no="") }}/><input class="search-input" name="imagefile" type="file" accept="image/*" /></label>
            </div>
            <div class="search-row">
                <label>
                    <span>Distance:</span>
                    <input class="search-distance" name="distance" type="number"
                           min="0" max="64"
                           value="{{ form.distance }}"/>
                </label>
                <div class="search-nsfw-box">
                    <span>NSFW:</span>
                    <label>
                        <span>Only</span>
                        <input class="search-nsfw" type="radio" name="nsfw" value="only" {{ macros::nsfw_checked(input=form.nsfw, match="only") }}/>
                    </label>
                    <label>
                        <span>Allow</span>
                        <input class="search-nsfw" type="radio" name="nsfw" value="allow" {{ macros::nsfw_checked(input=form.nsfw, match="allow") }}/>
                    </label>
                    <label>
                        <span>Never</span>
                        <input class="search-nsfw" type="radio" name="nsfw" value="never" {{ macros::nsfw_checked(input=form.nsfw, match="never") }}/>
                    </label>
                </div>
            </div>
            <div class="search-row">
                <input class="search-send" type="submit" value="Search" />
            </div>
        </form>
        <script>
         let form = $("#search-form");

         let link_input = $("#search-link .search-input");
         let file_input = $("#search-file .search-input");

         let link_check = $("#search-link .search-upload-type");
         let file_check = $("#search-file .search-upload-type");

         let setLink = function(event) {
             form.method = "get";
             form.enctype = "application/x-www-form-urlencoded";

             link_check.checked = true;

             link_input.required = true;
             file_input.required = false;
         };
         let setFile = function(event) {
             form.method = "post";
             form.enctype = "multipart/form-data";

             file_check.checked = true;

             link_input.required = false;
             file_input.required = true;
         };

         $("#search-link").oninput = setLink;
         link_input.onfocus = setLink;

         $("#search-file").oninput = setFile;
         file_input.onfocus = setFile;

         if (file_check.checked) {
             setFile();
         } else {
             setLink();
             link_input.focus(true);
         }
        </script>
        {% if error %}
            <p>Error: {{ error }}</p>
        {% elif findings is null %}
            <p>No search yet...</p>
        {% else %}
            {% if form.upload %}
                <p>You uploaded an image</p>
            {% else %}
                <p>You searched for <a href="{{ form.link }}">{{ form.link }}</a></p>
            {% endif %}
        {% endif %}
    </div>
    {% if findings is not null %}
        {% include "findings.html" %}
    {% endif %}
{% endblock %}
